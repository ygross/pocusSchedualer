<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>LEAD-ASSIGNMENT</title>
  <style>
    :root{
      --nav:#0b2c66; --bg:#f3f4f6; --card:#fff; --line:#e5e7eb; --muted:#6b7280;
      --bad:#dc2626; --ok:#16a34a; --warn:#b45309; --shadow:0 14px 34px rgba(15,23,42,.08);
      --r:18px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Arial,sans-serif;background:linear-gradient(180deg,#eaf1ff,#f3f4f6);color:#0f172a}
    header{background:var(--nav);color:#fff;padding:12px 16px;display:flex;justify-content:space-between;gap:12px;align-items:flex-start}
    .purpose{font-size:12px;opacity:.95;font-weight:900}
    .title{font-weight:1000;font-size:18px;margin-top:4px}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
    main{max-width:1250px;margin:auto;padding:18px;display:flex;flex-direction:column;gap:14px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:var(--r);padding:16px;box-shadow:var(--shadow)}
    h2{margin:0 0 10px 0;color:var(--nav);font-size:18px;font-weight:1000}
    .sub{margin:6px 0 0;color:var(--muted);font-size:13px;font-weight:900}
    .row{display:flex;flex-wrap:wrap;gap:10px;align-items:end}
    .field{flex:1;min-width:320px}
    label{display:block;font-size:13px;font-weight:1000;margin-bottom:6px}
    select,input{width:100%;padding:10px;border:1px solid var(--line);border-radius:12px;font-size:14px;background:#fff}
    .actions{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end}
    .btn{border:1px solid var(--nav);background:#fff;color:var(--nav);border-radius:14px;padding:10px 12px;font-weight:1000;cursor:pointer}
    .btn.primary{background:var(--nav);color:#fff}
    .btn.danger{border-color:var(--bad);color:var(--bad)}
    .btn:disabled{opacity:.55;cursor:not-allowed}
    .msg{margin-top:10px;font-size:13px;color:var(--muted);font-weight:900}
    .msg.ok{color:var(--ok)}
    .msg.err{color:var(--bad)}
    table{width:100%;border-collapse:separate;border-spacing:0;border:1px solid var(--line);border-radius:16px;overflow:hidden;background:#fff}
    thead th{background:#f8fafc;padding:12px;border-bottom:1px solid var(--line);text-align:right;font-weight:1000;white-space:nowrap}
    tbody td{padding:12px;border-bottom:1px solid var(--line);font-weight:900;text-align:right;vertical-align:middle}
    tbody tr:last-child td{border-bottom:none}
    .pill{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;border:1px solid var(--line);background:#fff;font-weight:1000;font-size:12px;white-space:nowrap}
    .pill.ok{border-color:rgba(22,163,74,.25);background:rgba(22,163,74,.08);color:var(--ok)}
    .pill.bad{border-color:rgba(220,38,38,.25);background:rgba(220,38,38,.08);color:var(--bad)}
    .pill.warn{border-color:rgba(180,83,9,.25);background:rgba(180,83,9,.08);color:var(--warn)}
    .muted{color:var(--muted);font-weight:900}
    .small{font-size:12px}
    .right{display:flex;gap:8px;justify-content:flex-end;flex-wrap:wrap}

    /* Modal */
    .backdrop{position:fixed;inset:0;background:rgba(15,23,42,.55);display:none;align-items:center;justify-content:center;padding:14px;z-index:9999}
    .modal{width:min(980px,100%);background:#fff;border-radius:22px;border:1px solid var(--line);box-shadow:0 30px 70px rgba(0,0,0,.25);overflow:hidden}
    .modalHead{background:#f8fafc;border-bottom:1px solid var(--line);padding:12px 14px;display:flex;justify-content:space-between;align-items:center;gap:10px}
    .modalTitle{font-weight:1000;color:var(--nav)}
    .modalBody{padding:14px;display:flex;flex-direction:column;gap:12px}
    .modalFoot{padding:12px 14px;border-top:1px solid var(--line);display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap}
    .cand{display:flex;gap:10px;align-items:center;flex-wrap:wrap;border:1px solid var(--line);border-radius:14px;padding:10px;background:#fff}
    .cand b{min-width:200px}
    .kpiRow{display:flex;gap:10px;flex-wrap:wrap}
  </style>
</head>

<body>
<header>
  <div>
    <div class="purpose">ייעוד הדף: מרכז קורס (Lead) רואה רק את הפעילויות שלו, מנהל זמינויות למופעים, משבץ מדריכים ושולח מיילים.</div>
    <div class="title">LEAD-ASSIGNMENT</div>
    <div class="purpose">API בסיס: <span id="apiBaseLabel" class="mono">…</span></div>
  </div>
  <div style="text-align:left;font-size:12px;opacity:.95">
    <div id="meLine">משתמש: טוען…</div>
    <div id="roleLine">תפקיד: טוען…</div>
  </div>
</header>

<main>

  <section class="card">
    <h2>בחירת פעילות</h2>
    <div class="sub">רק פעילויות שאתה מרכז (Lead). Admin רואה הכל.</div>

    <div class="row" style="margin-top:10px">
      <div class="field">
        <label>פעילות</label>
        <select id="activitySel"></select>
      </div>

      <div class="actions">
        <button id="btnReload" class="btn" type="button">רענן</button>
      </div>
    </div>

    <div id="activityMsg" class="msg"></div>
  </section>

  <section class="card">
    <h2>מופעים לפעילות</h2>
    <div class="sub">ליד כל מופע: נדרש / הציעו זמינות / שובצו + פעולות בקשת זמינות ושיבוץ.</div>

    <div class="kpiRow" style="margin:10px 0">
      <span id="kpiInstances" class="pill">מופעים: -</span>
      <span id="kpiEligible" class="pill">מדריכים רלוונטיים: -</span>
    </div>

    <div class="small muted" id="instancesHint">בחר פעילות כדי לראות מופעים.</div>

    <div style="overflow:auto;margin-top:10px">
      <table>
        <thead>
          <tr>
            <th>מופע</th>
            <th>טווח</th>
            <th>נדרש</th>
            <th>הציעו זמינות</th>
            <th>שובצו</th>
            <th>פעולות</th>
          </tr>
        </thead>
        <tbody id="instancesBody">
          <tr><td colspan="6" class="muted">—</td></tr>
        </tbody>
      </table>
    </div>

    <div id="instancesMsg" class="msg"></div>
  </section>

</main>

<!-- Modal -->
<div id="backdrop" class="backdrop" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modalHead">
      <div>
        <div id="modalTitle" class="modalTitle">שיבוץ מדריכים</div>
        <div id="modalSub" class="small muted">—</div>
      </div>
      <button id="btnClose" class="btn" type="button">סגור</button>
    </div>

    <div class="modalBody">
      <div class="kpiRow">
        <span id="mReq" class="pill">נדרש: -</span>
        <span id="mAssigned" class="pill">שובצו: -</span>
        <span id="mMissing" class="pill">חסרים: -</span>
      </div>

      <div class="small muted">
        הרשימה כוללת רק מדריכים שהציעו זמינות למופע. הסדר: <b>צדק (פחות שיבוצים קודם)</b> → <b>זמינות</b> → שם.
      </div>

      <div class="right">
        <button id="btnAutoPick" class="btn" type="button" disabled>בחר אוטומטי עד החסרים</button>
      </div>

      <div id="candWrap">
        <div class="muted">טוען…</div>
      </div>

      <div id="modalMsg" class="msg"></div>
    </div>

    <div class="modalFoot">
      <div class="small muted">בעת אישור – המדריכים שנבחרו יקבלו מייל.</div>
      <div class="right">
        <button id="btnApprove" class="btn primary" type="button" disabled>אשר שיבוץ + שלח מייל</button>
      </div>
    </div>
  </div>
</div>

<script src="js/LEAD-ASSIGNMENT.js"></script>
</body>
</html>
